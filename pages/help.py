# help.py â€” Comprehensive Help & FAQ for AI Literature Helper

import streamlit as st

st.set_page_config(page_title="â„¹ï¸ Help â€” AI Literature Helper", page_icon="â„¹ï¸")

# Always visible description
st.title("â„¹ï¸ Help & FAQ â€” AI Literature Helper")

st.markdown("""
Welcome to **AI Literature Helper** ğŸ‘‹  
This page provides detailed instructions, common issues, and troubleshooting tips.

---

## ğŸš€ Quick Start
1. Select a mode: **Keyword Search**, **Paste Citation / Text**, or **Lookup by URL / DOI / PDF**.
2. Run the search to fetch papers.
3. Review **AI annotations**: abstract, tags, relevance score.
4. (Optional) Export results to **Zotero**.

---
""")

# Sidebar navigation
section = st.sidebar.radio(
    "ğŸ“‘ Help Topics",
    [
        "Usage Instructions",
        "Boolean Queries",
        "AI Annotations & Relevance",
        "API Errors",
        "Zotero Issues",
        "PDF / URL Problems",
        "Search Results Issues",
        "Paste Citation Mode Issues",
        "Performance & Limits",
        "Tips & Best Practices",
        "FAQs",
        "Ask Gemini",
    ]
)

# Section content
if section == "Usage Instructions":
    st.header("ğŸ§­ Usage Instructions")
    st.markdown("""
    - **Keyword Search** â†’ enter topic/keywords, optionally optimize with AI Boolean queries, and select sources.
    - **Paste Citation / Text** â†’ paste Google Scholar results or citations, AI extracts metadata.
    - **URL / DOI / PDF Lookup** â†’ paste a DOI, article URL, or PDF link; metadata is fetched automatically.
    - **Zotero Export** â†’ enable in sidebar, provide credentials, and set relevance threshold.
    """)

elif section == "Boolean Queries":
    st.header("ğŸ”¤ Boolean Queries")
    st.markdown("""
    - AI can generate Boolean queries with AND/OR/NOT.
    - PubMed truncates queries to 300 characters â†’ keep them concise.
    - Always review/edit AI-suggested queries for precision.
    - Example: `"CRISPR" AND "prime editing" NOT "review"`.
    """)

elif section == "AI Annotations & Relevance":
    st.header("ğŸ¤– AI Annotations & Relevance Scoring")
    st.markdown("""
    - **Abstract (AI)**: 10â€“15 sentences, generated by Gemini.
    - **Tags**:
      - `aRT` â†’ research topic
      - `aTa` â†’ subtopics
      - `aTy` â†’ paper type
      - `aMe` â†’ methods
      - `ai score-N` â†’ relevance score (0â€“3)
    - **Relevance score (0â€“3)**:
      - 0 = marginal
      - 1 = low
      - 2 = moderate
      - 3 = highly relevant
    - Use it as a **filter**, not absolute truth.
    """)

elif section == "API Errors":
    st.header("âš ï¸ API Errors & Fixes")
    st.markdown("""
    **Semantic Scholar**
    - â€œSemantic Scholar failedâ€ â†’ rate limit exceeded (1 request/sec). Slow down.
    - Missing metadata â†’ Some papers donâ€™t include abstracts/DOIs.

    **PubMed**
    - â€œESearch/ESummary failedâ€ â†’ Timeout or network issue. Retry with fewer results.
    - Query too long â†’ PubMed truncates after 300 chars.
    - No abstract returned â†’ Some PubMed entries lack abstracts.

    **Google Fallback**
    - May return irrelevant results. Refine your title search.
    """)

elif section == "Zotero Issues":
    st.header("ğŸ“¥ Zotero Integration Issues")
    st.markdown("""
    - **Initialization error** â†’ Check API key, User ID, and Collection ID.
    - **Skipped export** â†’ Paper scored below threshold or duplicate detected.
    - **Duplicate detection**:
      - Compares Title and DOI.
      - Best-effort only â†’ may miss some.
    - **Allow duplicates** â†’ Toggle in sidebar if needed.
    """)

elif section == "PDF / URL Problems":
    st.header("ğŸ“„ PDF / URL Problems")
    st.markdown("""
    - **â€œNot a PDFâ€**:
      - Some servers mislabel PDFs.
      - Fix â†’ detection also checks `%PDF` file signature.
    - **No text extracted** â†’ Scanned/image-only PDFs cannot be parsed.
    - **Broken URL** â†’ Ensure the link is public and accessible.
    - **Publisher redirects** â†’ May require institutional login. Use NTU proxy links if available.
    """)

elif section == "Search Results Issues":
    st.header("ğŸ” Search Results Issues")
    st.markdown("""
    - **No results** â†’ Query too specific. Broaden keywords.
    - **Too many irrelevant results** â†’ Use AI Boolean queries, add NOT clauses.
    - **Old papers only** â†’ Add date filters manually in PubMed or Semantic Scholar.
    - **Repeated entries** â†’ Deduplication removes most, but not all duplicates.
    """)

elif section == "Paste Citation Mode Issues":
    st.header("ğŸ“‹ Paste Citation Mode Issues")
    st.markdown("""
    - **â€œNothing extractedâ€** â†’ Format not recognized. Paste one citation per line.
    - **Authors missing/wrong** â†’ AI may confuse affiliations. Verify manually.
    - **Year not detected** â†’ Some citations donâ€™t include years.
    - **Multiple citations merged** â†’ Paste them clearly separated.
    """)

elif section == "Performance & Limits":
    st.header("âš¡ Performance & Limits")
    st.markdown("""
    - **Rate limits**:
      - Semantic Scholar â†’ 1 request/second.
      - PubMed â†’ variable, may throttle heavy users.
    - **Timeouts** â†’ Default request timeout is 30â€“45s.
    - **Progress bar stuck** â†’ Refresh the app.
    - **Large PDF extraction** â†’ Only first 5000â€“8000 chars are used.
    """)

elif section == "Tips & Best Practices":
    st.header("ğŸ’¡ Tips & Best Practices")
    st.markdown("""
    - Keep keyword queries **short and focused**.
    - Edit Boolean queries before PubMed searches.
    - Paste clean citations (one per line).
    - Start with **smaller result sets** and scale up.
    - Use **priority topics/authors** in the sidebar to influence relevance.
    - Always verify AI abstracts against the original paper.
    """)

elif section == "FAQs":
    st.header("â“ Frequently Asked Questions")
    st.markdown("""
    **Q: Can I trust AI abstracts?**  
    A: They are summaries â€” always double-check with the original paper.

    **Q: Why does relevance scoring feel wrong sometimes?**  
    A: Itâ€™s heuristic, factoring in keywords, venue, and AI judgment. Use as guidance.

    **Q: Can I add my own topics/authors?**  
    A: Yes â€” in the sidebar preferences. They influence scoring and tags.

    **Q: Does this work for all disciplines?**  
    A: Best for biomedical, computer science, and natural sciences. Some areas may have weaker coverage.

    **Q: Can I export to formats other than Zotero?**  
    A: Not directly. Export via Zotero, then convert to BibTeX, RIS, EndNote, etc.
    """)

elif section == "Ask Gemini":
    st.header("ğŸ¤– Ask Gemini")
    st.markdown("""
    Still stuck? You can chat directly with **Google Gemini** for extra help:  
    ğŸ‘‰ [**Ask Gemini**](https://gemini.google.com/)
    """)

